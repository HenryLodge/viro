# VIRO -- Viral Intelligence & Response Orchestrator

AI-powered triage, routing, and surveillance for pandemic response. Built for InnovAIte 2026.

## Tech Stack

- **Framework:** Next.js 14 (App Router, TypeScript)
- **Styling:** Tailwind CSS + shadcn/ui
- **Backend:** Supabase (Postgres, Auth, Real-time)
- **AI:** OpenAI GPT-4o (triage, pattern detection, forecasting, report generation)
- **Visualization:** Globe.gl (Three.js), Recharts, react-force-graph-2d
- **Maps:** Leaflet.js / react-leaflet
- **Deploy:** Vercel

## Features

- **Patient Intake & AI Triage** -- Patients submit symptoms through a guided form; GPT-4o assigns a triage tier (critical / urgent / routine / self-care) with reasoning and next-step recommendations.
- **Provider Dashboard** -- Globe and network graph views of the patient population with real-time Supabase subscriptions.
- **Symptom Network Graph** -- Force-directed graph computing patient similarity across symptoms, travel, geography, and exposure. Connected-component clustering with automatic alert generation.
- **AI Natural Language Query** -- Analysts type plain English queries ("Show critical patients over 65 in Boston") and GPT-4o translates them to structured filters applied instantly to the graph.
- **AI Pattern Detection** -- GPT-4o scans aggregated surveillance data and surfaces emerging epidemiological signals not captured by rule-based alerts.
- **Outbreak Trend Forecasting** -- When drilling into a cluster, GPT-4o analyzes the growth curve and produces a 7-day projection with a narrative risk assessment.
- **AI Report Generation** -- Audience-adaptive intelligence briefings (Government SitRep, Hospital Executive Briefing, Technical Analysis) generated by GPT-4o and stored in Supabase.
- **Anomaly Alerts Sidebar** -- Cluster alerts with growth rates, geographic spread, and recommended actions.
- **Time Slider & Filters** -- Filter the network by age, triage tier, symptoms, region, and time window.
- **CSV Export** -- Export filtered patient data as CSV.

## Setup

1. **Install dependencies**

   ```bash
   npm install
   ```

2. **Environment variables**

   Create a `.env.local` file with your keys:

   ```
   NEXT_PUBLIC_SUPABASE_URL=<your-supabase-url>
   NEXT_PUBLIC_SUPABASE_ANON_KEY=<your-anon-key>
   SUPABASE_SERVICE_ROLE_KEY=<your-service-role-key>
   OPENAI_API_KEY=<your-openai-key>
   ```

3. **Database**

   Run the migrations in order via the Supabase SQL Editor or CLI:

   ```
   supabase/migrations/20260214000001_profiles.sql
   supabase/migrations/20260214000002_tables.sql
   supabase/migrations/20260215000001_patient_location.sql
   supabase/migrations/20260215000002_cluster_alerts.sql
   supabase/migrations/20260215000003_reports.sql
   ```

   Or with the Supabase CLI: `supabase db push`

4. **Seed data (optional)**

   Generate synthetic pandemic patient data:

   ```bash
   npx tsx scripts/generate-pandemic-seed.ts
   ```

5. **Run the dev server**

   ```bash
   npm run dev
   ```

   Open [http://localhost:3000](http://localhost:3000).

## Project Structure

```
app/
  page.tsx                          # Landing page
  login/page.tsx                    # Sign in / Sign up
  patient/
    intake/page.tsx                 # Symptom intake form
    results/page.tsx                # Triage result + hospital map
    status/page.tsx                 # Tracking / status
  provider/
    dashboard/page.tsx              # Globe + network graph + sidebar
    reports/page.tsx                # Report list + generate form
    reports/[id]/page.tsx           # Full report view
  api/
    auth/profile/route.ts           # GET/POST user profile
    triage/route.ts                 # AI triage endpoint
    hospitals/route.ts              # Hospital data
    network/route.ts                # Compute symptom network graph
    network/query/route.ts          # AI natural language query
    network/patterns/route.ts       # AI pattern detection
    network/forecast/route.ts       # AI outbreak forecasting
    reports/route.ts                # Report list + generate
    reports/[id]/route.ts           # Single report

lib/
  triage.ts                         # GPT-4o triage prompt + parser
  network-engine.ts                 # Similarity computation + clustering
  ai-query.ts                       # NL query -> structured filters
  ai-patterns.ts                    # Emerging pattern detection
  ai-forecast.ts                    # Outbreak trend forecasting
  ai-report.ts                      # Audience-adaptive report generation
  export-csv.ts                     # CSV export utility

components/provider/
  NetworkGraph.tsx                   # Force-directed graph (react-force-graph-2d)
  NetworkDrillDown.tsx               # Cluster/node drill-down + forecast chart
  NetworkFilterPanel.tsx             # Filter sidebar
  NetworkTimeSlider.tsx              # Temporal filter
  NetworkQueryBar.tsx                # AI query input
  AiInsightsPanel.tsx                # AI pattern insight cards
  AnomalyAlertsSidebar.tsx           # Cluster alerts + AI insights
  GlobeVisualization.tsx             # 3D globe view
```

## Scripts

- `npm run dev` -- start dev server
- `npm run build` -- production build
- `npm run start` -- start production server
- `npm run lint` -- run ESLint

## Docs

Full product and technical spec: `projdocs/Viro_PRD.md`
